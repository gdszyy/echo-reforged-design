# “功法”系统设计文档 (Technique System)

> **文档版本**: 0.1 (草案)
> **最后更新**: 2026-01-06

## 一、核心理念：波粒二象性与构筑复现

“功法”系统是《Echo Reforged》中连接**钉盘布局（因）**与**子弹行为（果）**的核心桥梁，是玩家将无序的实验转化为稳定构筑的体现。它旨在模拟修仙小说中“顿悟”和“创造功法”的过程，其设计哲学根植于“波粒二象性”的隐喻：

- **“粒”的形态 (Particle Nature)**: 玩家在钉盘上自由摆放钉子，发射弹珠。弹珠的轨迹遵循混沌的物理法则，每一次撞击都是一次独立的、充满不确定性的**物理模拟**。这是玩家的**实验阶段**，充满了随机性。

- **“波”的形态 (Wave Nature)**: 当玩家的某次钉盘布局产生了一次特别强大的、可复现的子弹效果时，系统会帮助玩家“领悟”这次实验。这次成功的布局（特定的钉子组合与排布）及其产生的效果（特定的属性层数组合）会被记录下来，形成一本**“功法秘籍”**。此时，混沌的物理过程**坍缩**为一个确定的**概率波函数**。玩家可以通过这本秘籍，在满足条件下**稳定复现**这次强大的构筑，将随机性转化为确定性。

这个从“粒子”到“波”的转化过程，即是玩家“创造功法”的过程。

## 二、“功法”的数据结构

每一本“功法”都是一个结构化的数据对象，记录了从钉子布局到预期产出的完整映射。这将作为游戏存档和逻辑处理的基础。

```json
{
  "id": "tech_scatter_001",
  "name": "万剑诀",
  "category": "散射类",
  "description": "通过特定的散射与穿透钉子组合，使子弹在首次命中时必定分裂，并有极大概率进行二次分裂，形成剑雨。",
  "unlock_condition": "在单次发射中，通过钉盘组合，使子弹的散射层数 >= 3 且穿透层数 >= 2。",
  "pegboard_pattern": [
    { "x": 0, "y": 1, "peg_type": "scatter_peg", "level": 2 },
    { "x": 1, "y": 2, "peg_type": "scatter_peg", "level": 1 },
    { "x": -1, "y": 2, "peg_type": "pierce_peg", "level": 2 },
    { "x": 0, "y": 3, "peg_type": "scatter_peg", "level": 1 }
  ],
  "expected_output": {
    "attributes": [
      { "type": "scatter", "layers": 3.5 },
      { "type": "pierce", "layers": 2.0 }
    ],
    "synergy_effect": "Guaranteed primary fission with high probability of secondary fission."
  }
}
```

### 数据结构详解

| 字段 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | String | 功法的唯一标识符，用于内部索引。 |
| `name` | String | 功法的名称，展示给玩家。 |
| `category` | String | 功法分类（如：聚气类, 散射类, 引导类, 共振类, 分身类）。 |
| `description` | String | 对功法效果的文字描述，帮助玩家理解其战术价值。 |
| `unlock_condition` | String | 玩家“领悟”该功法的具体条件。这是系统判断玩家是否“顿悟”的依据。 |
| `pegboard_pattern` | Array | **核心字段**。记录了构成该功法的**最小钉子组合**的相对位置和类型。这并非要求钉盘上只有这些钉子，而是要求**必须包含**这个模式。 |
| `expected_output` | Object | 描述该功法稳定触发时的预期效果，包括具体的属性层数和由此产生的核心联动效果。 |

## 三、功法的发现、记录与使用

1.  **发现 (Discovery)**: 玩家在游戏中不断调整钉盘布局。当某次发射的子弹属性组合满足了某个未解锁功法的 `unlock_condition` 时，系统判定玩家“顿悟”。

2.  **记录 (Recording)**: 触发“顿悟”后，游戏会弹出提示，告知玩家领悟了新的功法。这本“功法秘籍”将被添加到玩家的“功法库”中，永久解锁。

3.  **使用 (Activation)**: 在后续的游戏中，玩家可以在战斗准备阶段“研习”已学会的功法。选择一本功法后，系统会高亮提示玩家需要在钉盘上如何摆放钉子来满足其 `pegboard_pattern`。一旦玩家成功在自己的钉盘上复现了这个模式，该功法即被**激活**。

4.  **激活效果**: 功法激活后，从该钉盘发射的子弹将获得一个**稳定加成**，确保其属性**不低于** `expected_output` 中定义的数值。这相当于为玩家的构筑提供了一个强力的“保底”，将随机的弹跳转化为可预期的强力输出。

## 四、功法示例（草案）

以下是根据新的属性系统设计的几个功法草案，用于阐明设计思路。

### 1. 分身类 (Nested/Progenitor)

- **功法名称**: 《一气化三清》
- **描述**: 以一个高等级的母体钉为核心，辅以两个低等级的母体钉，使得母体在释放常规子代的同时，有概率额外释放两个不带属性的“幻影分身”。
- **核心模式**: 一个 Lv3 `Nested` 钉，周围环绕两个 Lv1 `Nested` 钉。
- **预期产出**: 母体子弹 + 2个额外的“幻影”子弹。

### 2. 散射类 (Scatter)

- **功法名称**: 《天女散花》
- **描述**: 结合高等级的散射和爆炸钉，使得分裂出的子弹丸在消失时能产生连锁爆炸。
- **核心模式**: 多个 `Scatter` 钉与 `Explosion` 钉呈特定几何排列。
- **预期产出**: `Scatter` >= 4, `Explosion` >= 2。分裂出的子弹继承爆炸属性。

### 3. 激光类 (Laser)

- **功法名称**: 《洞玄光》
- **描述**: 组合激光、反弹、穿透三种钉子，形成一道可以在场景中多次反射的切割光束。
- **核心模式**: `Laser`, `Bounce`, `Pierce` 三种钉子在一条直线上。
- **预期产出**: `Laser` >= 2, `Bounce` >= 3, `Pierce` >= 5。形成一道可3次反射的粗长激光。

---

## 五、开放问题与下一步

1.  **功法激活的代价**: 激活功法是否需要消耗特定资源？或者仅仅是满足布局要求即可？
2.  **功法升级**: 功法本身是否可以升级？例如，通过重复触发来提升其“保底”效果？
3.  **负面功法**: 是否存在一些虽然效果强大，但带有负面效果的“禁术”或“魔功”？
4.  **UI/UX 设计**: 如何在界面上清晰地引导玩家学习、查阅和激活功法？
