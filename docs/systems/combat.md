# 战斗框架设计文档

> **文档版本**: 0.2 (修订版)
> **最后更新**: 2025-01-06

## 概述

《Echo Reforged》的战斗系统是游戏三大核心支柱（战斗、探索、构建）的交汇点。它以"回合制打砖块"为基础，深度融合了物理弹射的爽快感与策略构建的深度，并遵循"世界即战场"的核心理念。

### 核心设计原则

1.  **物理与策略的结合**: 玩家的每一次射击既是考验操作技巧的物理谜题，也是检验其 Build 构筑策略的最终考试。
2.  **环境即是挑战**: 战斗场景不是静态的背景，而是动态的、可互动的，充满了由世界地块属性带来的机遇和危险。
3.  **清晰的因果反馈**: 玩家通过 Build 系统"编程"出的子弹，其行为和效果必须在战场上得到直观、震撼的体现。

---

## 一、战斗场景的构成

战斗并非在独立的"副本"中进行，而是直接在世界大地图的"地块"上展开。战斗场景主要由以下元素构成：

*   **玩家区域**: 位于场景底部，玩家的发射器在此处。
*   **"砖块场" (Brick Field)**: 占据场景的主要部分，是弹珠交互的核心区域。其中包含了：
    *   **敌人 (Enemies)**: 以拥有生命值的"砖块"形式存在，是玩家的主要目标。
    *   **资源矿脉 (Resource Veins)**: 如 β 晶石矿，可被攻击并掉落资源。
    *   **场景障碍物 (Obstacles)**: 如坚不可摧的岩石、可被摧毁的碎石墙等。
    *   **环境危害 (Hazards)**: 如周期性喷发的岩浆口、会造成减速的冰面等。

战斗场景的整体布局、敌人种类、资源和障碍物的配置，完全由战斗发生时所在的世界地块的属性和状态决定。

---

## 二、战斗流程："装填-发射"循环 (Load & Fire Cycle)

为了解决决策阶段打断战斗节奏的问题，我们采用一种全新的"装填-发射"循环。这个循环将重量级决策前置，并在一个周期内给予玩家连续、流畅的战斗体验。

### 2.1 核心概念：弹珠与充能

- **弹珠 (Marbles)**: 弹珠是战斗的核心"弹药"。它们通过敌人掉落的材料合成，每种弹珠都拥有**固有的子弹性质**（如：激光、爆炸、穿透等）。
- **充能 (Charging)**: 战斗开始时或在战斗中，玩家需要选择一种弹珠来为发射器"充能"。
- **发射次数 (Fire Charges)**: 弹珠的**等级**决定了本次充能后，发射器可以**发射的次数**。例如，一个3级爆炸弹珠可以让发射器连续发射3次。

### 2.2 战斗循环详解

**1. 装填回合 (Load Turn)**

- **时机**: 战斗开始时，或当发射器的"发射次数"耗尽后，玩家必须执行一个"装填回合"。
- **决策**: 玩家从自己拥有的弹珠中选择一个，为当前的主力发射器充能。这是一个关键的策略决策点，决定了接下来一个战斗阶段的基本战术（用爆炸弹珠清场？还是用激光弹珠点杀？）。
- **消耗**: 装填会消耗一整个回合。

**2. 发射阶段 (Fire Phase)**

- **连续发射**: 在装填完成后，玩家进入发射阶段。只要发射器还拥有"发射次数"，玩家就可以在自己的回合内**连续发射**。
- **单次发射流程**:
    a. **瞄准 (Aiming)**: 选择发射角度。
    b. **钉盘编程 (Pegboard Programming)**: 弹珠在钉盘上弹跳，实时叠加属性。
    c. **战场交互 (Battlefield Interaction)**: 编程后的弹珠进入战场，造成伤害和效果。
- **策略点**: 玩家可以选择在一个回合内打出所有"发射次数"以求爆发，也可以只打一两次，保留次数以应对下回合的变局。

**3. 敌人回合 (Enemy Turn)**

- **触发时机**: 当玩家主动结束自己的回合（无论是否用完所有发射次数），或因为执行"装填回合"而无法攻击时，轮到敌人行动。
- **行动**: 所有存活的敌人根据其预设的"行动意图"（会在其头顶显示图标，如剑、盾、魔法杖）依次行动。
- **行动方式**: 包括直接攻击玩家、自我强化、治疗同伴、改变战场环境（如制造障碍物）等。
- 敌人回合结束后，行动权交还给玩家，开始新的循环。

### 2.3 多发射器切换 (Multi-Launcher Switching)

- **携带与切换**: 玩家可以携带一个以上的发射器进入战斗（例如，最多3把），但任何时候只能有一把是"激活"状态。
- **切换成本**: 在战斗中切换到另一把发射器，需要**消耗一整个回合**。执行"切换"动作后，玩家的回合立即结束。
- **策略意图**: 切换武器是一个重要的战术决策，而非无代价的便利操作。玩家需要权衡"牺牲当前回合的行动机会"与"使用更合适的武器应对未来挑战"之间的利弊。这鼓励玩家在战前就想好主力发射器，只在战局发生重大变化时才考虑切换。

### 2.4 消耗品系统：闲置资源的战术转化

游戏包含两种类型的消耗品，它们共同构成了一个富有深度的资源转化与战术决策系统。

**A. 战略消耗品 (Strategic Consumables)**

- **使用时机**: 只能在**世界地图**上，战斗之外使用。
- **核心定位**: 作为战略储备，用于战前准备或战后恢复。
- **制作材料**: 通常由**通用资源**（如 β 晶石碎片、从敌人身上掉落的通用零件）制作。
- **示例**:
    - **维修工具包**: 修复在上场战斗中被摧毁的 1-3 个钉子。
    - **磨刀石**: 为下一场战斗的所有物理伤害提供 +10% 的临时加成。
    - **地块扫描仪**: 揭示周围一个未知地块的具体属性和敌人强度。

**B. 战术消耗品 (Tactical Consumables)**

- **使用时机**: 可以在**战斗中**使用，但会**消耗整个回合的行动机会**。
- **核心定位**: 作为战术奇兵，用于应对紧急情况或创造突破口。
- **制作材料**: **核心设计**——战术消耗品由玩家**当前 Build 未使用的"闲置精华"**制作而成。这为所有类型的掉落物都赋予了价值，并鼓励玩家为了制作特定道具而去挑战不同区域。
- **示例**:
    - **冰霜炸弹**: （由"冰霜精华"制作）投掷后冻结一个小范围内的所有敌人，持续 1 回合。对于一个主玩火系的玩家来说，囤积的冰霜精华终于有了用武之地。
    - **引力奇点**: （由"重力精华"制作）将一个大范围内的所有敌人吸引到中心点，为 AOE 攻击创造绝佳机会。
    - **钉盘护盾**: （由"坚韧精华"制作）制造一个可以抵挡下一次远程攻击的护盾，保护你的钉盘。

### 2.5 弹珠合成：自由炼金系统 (Freeform Alchemy Synthesis)

**核心理念**: 秉承"炼金"主题，弹珠的制作过程摒弃了固定的"蓝图"或"配方"，完全交由玩家自由探索和发现。

**1. 炼金台 (Alchemy Bench)**
- 在据点中，玩家可以与"炼金台"互动，这是进行弹珠合成的唯一场所。

**2. 混合材料 (Mixing Ingredients)**
- 玩家可以将收集到的各种**材料**（主要是不同种类的"精华晶石"，但也可能包括其他特殊掉落物）放入炼金台的槽位中。
- 投入的材料**种类、数量和比例**将共同决定最终产物的属性。

**3. 发现与创造 (Discovery & Creation)**
- 当玩家点击"合成"时，系统会根据内部的一套复杂但自洽的规则，生成最终的弹珠。
- **示例**:
    - **火焰精华 x3** -> 可能产出 **2级火焰弹珠**
    - **火焰精华 x2 + 冰霜精华 x1** -> 可能因为冲突而**合成失败**，产出无用的"残渣"；但也可能在极低概率下产出稀有的**"蒸汽"弹珠**。
    - **锐利精华 x1 + 弹射精华 x1 + 火焰精华 x1** -> 可能产出带有"穿透"和"反弹"特性的**1级火焰弹珠**。

**4. 知识的价值 (The Value of Knowledge)**
- 游戏不会提供任何配方。玩家的每一次成功或失败的尝试，都应该被记录在游戏内的"炼金笔记"中。
- 这使得玩家的**知识**本身成为了最有价值的资产。一个经验丰富的玩家能够稳定地制作出高级弹珠，而新手则需要经历一个充满试错和惊喜的探索过程。
- 这个系统将"制作"从一个重复性劳动，转变成了一个持续的、充满乐趣的解谜和探索过程。

---

## 三、敌人设计

敌人不仅仅是等待被消除的砖块，它们拥有多样的行为模式，迫使玩家调整策略。

| 敌人类型 | 设计特点 | 应对策略 |
| :--- | :--- | :--- |
| **集群型 (Swarmer)** | 单个生命值低，但数量众多，占据大量空间。 | 需要具备"散射"或"反弹"能力的 Build 进行高效清场。 |
| **装甲型 (Armored)** | 拥有高额护甲，需要多次攻击才能对其造成有效伤害。 | 需要具备"穿透"能力的 Build，或通过高频攻击快速破甲。 |
| **狙击型 (Sniper)** | 位于战场的偏僻角落，攻击力高，但自身脆弱。 | 考验玩家的弹射技巧，需要精确打击。 |
| **辅助型 (Support)** | 不直接攻击，但会治疗同伴、为敌人施加护盾或召唤增援。 | 需要优先集火消灭，考验玩家的点杀能力。 |
| **环境互动型 (Environmental)** | 能够利用或改变战场环境，如在地上制造粘液陷阱，或激活场景中的危害。 | 迫使玩家改变弹射路线，或利用其行为反制敌人。 |

---

## 四、与 Build 及世界系统的联动

战斗系统是其他两大系统的最终表现舞台。

*   **Build 系统**: 玩家通过"钉盘养成"、"子弹编程"和"符文填字谜"构建出的一切，最终都将通过"玩家回合"中的弹珠行为得到验证。一个强大的 Build 应该能在复杂的战场环境中打出华丽而有效的攻击。
*   **世界系统**: 世界地块的属性决定了战斗的"初始牌局"——地形、敌人配置、可用资源。玩家在世界地图上的每一个移动决策，都是在为下一场可能的战斗选择战场。

---

## 五、玩家失败条件：双重致命威胁

游戏摒弃了传统的生命值（HP）系统，取而代之的是两种界限分明且同样致命的失败条件。这要求玩家必须同时应对来自战场空间和敌人远程火力的双重压力。

### 5.1 近战威胁：空间防守失败

- **机制**: 所有近战敌人会随着回合数稳步向玩家区域（屏幕底线）推进。
- **失败条件**: **任何一个**敌人单位成功抵达玩家区域，探索立即失败。
- **设计意图**: 这将战斗的核心从单纯的"消灭敌人"扩展到了"空间控制"和"阵线管理"。玩家需要不断利用击退、减速、清场等手段来维持安全距离，带有强烈的塔防策略色彩。

### 5.2 远程威胁：Build系统被破坏

- **机制**: 部分敌人（如弓箭手、法师）拥有远程攻击能力。它们的攻击目标不是玩家本身，而是玩家当前装备的**发射器钉盘**。
- **失败条件**: 每当远程攻击命中，会随机**摧毁**钉盘上的一个**钉子**。当钉盘上所有**有效的钉子**都被摧毁后，发射器失效，探索失败。
- **设计意图**: 这种威胁直接攻击玩家的核心 Build，使得保护钉盘、优先消灭远程高威胁单位成为战斗的首要任务。这也让玩家在选择钉子时，需要考虑一定的"冗余"和"韧性"。

---

## 六、发射器插件系统 (Launcher Attachments)

为了进一步增加发射器的差异化和玩家的自定义空间，引入插件系统。发射器可以像枪支一样加装各种插件，这些插件不影响钉盘和符文格，而是提供功能性或辅助性的加成。

| 插件类型 | 示例 | 设计定位 |
| :--- | :--- | :--- |
| **瞄准辅助** | "激光引导线"：获得更长、更精确的弹道预测线。 | 降低操作门槛，提升精确打击能力。 |
| **信息增强** | "热能探测器"：可以查看锥形范围内所有敌人的具体温度值和状态。 | 提升信息获取能力，辅助决策。 |
| **数据统计** | "战斗记录仪"：在战斗后提供详细的伤害统计报告。 | 满足数据爱好者的需求，帮助玩家优化 Build。 |
| **强制转换** | "聚焦棱镜"：将所有射出的子弹类型强制转换为"激光"，无论装填的是何种弹珠。 | 提供一种彻底改变发射器玩法的极端构筑方式。 |

---

## 七、开放问题与下一步

1.  **瞄准辅助**: 游戏是否提供弹道预测线？预测的精确度如何？这会极大影响游戏的操作门槛。
